# План реализации Telegram-бота FindOrigin

## Этап 1: Настройка проекта и инфраструктуры

### 1.1 Инициализация Next.js проекта
- Создать Next.js проект с TypeScript
- Настроить структуру папок (app router или pages router)
- Установить необходимые зависимости

### 1.2 Настройка окружения
- Создать файл `.env.local` для хранения:
  - `TELEGRAM_BOT_TOKEN` - токен бота от BotFather
  - `TELEGRAM_WEBHOOK_SECRET` - секрет для верификации webhook
  - `AI_API_KEY` - ключ для AI API (OpenAI, Anthropic и т.д.)
  - `SEARCH_API_KEY` - ключ для поискового API (Google Search API, SerpAPI и т.д.)

### 1.3 Настройка Git и деплоя
- Настроить `.gitignore` (уже есть)
- Подготовить проект к деплою на Vercel
- Настроить переменные окружения в Vercel

## Этап 2: Реализация Webhook для Telegram

### 2.1 Создание API route для webhook
- Создать API endpoint `/api/webhook` (POST)
- Реализовать валидацию запросов от Telegram
- Извлечение `chat.id` и `text` из `update.message`
- Быстрый возврат 200 OK (асинхронная обработка)

### 2.2 Обработка входящих сообщений
- Парсинг текста или ссылки на Telegram-пост
- Определение типа входящих данных (текст/ссылка)
- Извлечение текста из Telegram-поста по ссылке (если необходимо)

### 2.3 Интеграция с Telegram API
- Настройка отправки ответов через `sendMessage`
- Обработка ошибок API Telegram
- Логирование событий

## Этап 3: Извлечение и анализ данных

### 3.1 Парсинг Telegram-ссылок
- Реализовать функцию извлечения текста из Telegram-поста
- Обработка различных форматов ссылок (t.me/channel/123, telegram.me и т.д.)
- Обработка ошибок при недоступности поста

### 3.2 Извлечение ключевых элементов
- Реализовать NLP-обработку для выделения:
  - Ключевых утверждений
  - Дат
  - Чисел
  - Имен собственных
  - Ссылок
- Использовать библиотеки для NLP или AI API

### 3.3 Подготовка поисковых запросов
- Формирование поисковых запросов на основе извлеченных данных
- Оптимизация запросов для поиска источников

## Этап 4: Поиск источников информации

### 4.1 Интеграция с поисковым API
- Выбор и настройка поискового API (Google Custom Search, SerpAPI, Bing и т.д.)
- Реализация функции поиска по запросам
- Обработка результатов поиска

### 4.2 Фильтрация результатов
- Фильтрация по типам источников:
  - Официальные сайты
  - Новостные сайты
  - Блоги
  - Исследования
- Ранжирование результатов по релевантности

### 4.3 Сбор информации об источниках
- Извлечение метаданных (заголовок, описание, дата публикации)
- Проверка доступности источников
- Ограничение количества результатов (1-3 ссылки)

## Этап 5: AI-анализ и сравнение

### 5.1 Интеграция с AI API
- Выбор AI-провайдера (OpenAI GPT, Anthropic Claude и т.д.)
- Настройка промптов для семантического сравнения
- Реализация функции сравнения смысла (не буквального текста)

### 5.2 Семантический анализ
- Сравнение исходного текста с найденными источниками
- Оценка релевантности каждого источника
- Расчет оценки уверенности (confidence score)

### 5.3 Формирование ответа
- Структурирование результатов:
  - Список источников (1-3 ссылки)
  - Оценка уверенности для каждого
  - Краткое описание соответствия

## Этап 6: Форматирование и отправка ответа

### 6.1 Форматирование сообщения
- Создание читаемого формата ответа
- Использование Markdown для форматирования
- Добавление эмодзи и структурирования

### 6.2 Отправка ответа пользователю
- Отправка через Telegram API
- Обработка длинных сообщений (разбивка при необходимости)
- Обработка ошибок отправки

### 6.3 Обработка исключительных ситуаций
- Обработка случаев, когда источники не найдены
- Обработка ошибок AI-анализа
- Информативные сообщения об ошибках

## Этап 7: Оптимизация и улучшения

### 7.1 Асинхронная обработка
- Реализация очереди задач для долгих операций
- Использование фоновых задач (Vercel Background Functions или внешний сервис)
- Уведомление пользователя о начале обработки

### 7.2 Кэширование
- Кэширование результатов поиска для похожих запросов
- Оптимизация запросов к AI API

### 7.3 Логирование и мониторинг
- Настройка логирования всех операций
- Мониторинг производительности
- Отслеживание ошибок

## Этап 8: Тестирование и деплой

### 8.1 Локальное тестирование
- Тестирование webhook с помощью ngrok или локального туннеля
- Проверка всех сценариев использования
- Тестирование обработки ошибок

### 8.2 Деплой на Vercel
- Настройка проекта в Vercel
- Настройка переменных окружения
- Настройка webhook URL в Telegram Bot API

### 8.3 Финальное тестирование
- Тестирование в продакшене
- Проверка производительности
- Сбор обратной связи

## Этап 9: Документация и поддержка

### 9.1 Документация
- Обновление README.md с инструкциями по установке
- Документация API endpoints
- Примеры использования

### 9.2 Поддержка
- Настройка обработки частых вопросов
- Мониторинг использования бота
- Планирование улучшений
